<Page x:Class="Pet_Shop_Project.Views.OQPSuccess"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
      xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
      xmlns:local="clr-namespace:Pet_Shop_Project.Views"
      xmlns:services="clr-namespace:Pet_Shop_Project.Services"
      xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
      mc:Ignorable="d" 
      d:DesignHeight="487" d:DesignWidth="940"
      Title="OQPSuccess"
      Background="White">

    <Page.Resources>
        <services:ConvertLanguage x:Key="LangConverter"/>
    </Page.Resources>

    <Grid Margin='5'>
        <Grid.RowDefinitions>
            <RowDefinition Height='Auto'/>
            <RowDefinition Height='*'/>
        </Grid.RowDefinitions>

        <StackPanel Grid.Row='0' Orientation='Horizontal' HorizontalAlignment='Stretch' Margin='30,10,0,0'>
            <TextBlock Text='Tổng Số Đơn Hàng Đang Nhận: ' FontWeight='Bold' FontSize='15'/>
            <TextBlock Text='{Binding TotalOrderSuccess}' FontSize='15'/>
        </StackPanel>

        <ScrollViewer Grid.Row='1'
              VerticalScrollBarVisibility='Hidden' 
              Margin='20'
              Background='Transparent'>
            <ScrollViewer.Resources>
                <Style TargetType='ScrollBar'>
                    <Setter Property='Width' Value='6'/>
                    <Setter Property='Background' Value='Transparent'/>
                    <Setter Property='BorderThickness' Value='0'/>
                </Style>
            </ScrollViewer.Resources>
            <ItemsControl ItemsSource='{Binding OrderSuccesses}'>
                <ItemsControl.ItemTemplate>
                    <DataTemplate>
                        <Border Style='{StaticResource TemplateODQ}'
                            materialDesign:ShadowAssist.ShadowDepth='Depth1'>
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height='Auto'/>
                                    <RowDefinition Height='Auto'/>
                                    <RowDefinition Height='*'/>
                                    <RowDefinition Height='Auto'/>
                                </Grid.RowDefinitions>

                                <Grid Grid.Row='0' Margin='0,0,0,10'>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width='*'/>
                                        <ColumnDefinition Width='Auto'/>
                                    </Grid.ColumnDefinitions>

                                    <StackPanel Grid.Column='0'>
                                        <WrapPanel Margin='0,0,0,6'>
                                            <Border Background='#E8F2FF' CornerRadius='8' Padding='10,6' Margin='0,0,8,8'>
                                                <StackPanel Orientation='Horizontal' VerticalAlignment='Center'>
                                                    <materialDesign:PackIcon Kind='ClipboardTextClockOutline' Width='18' Height='18' Foreground='#3B67C8'/>
                                                    <TextBlock Text='{Binding OrderId}' Margin='8,0,0,0' FontWeight='Bold' Foreground='#1D3557'/>
                                                </StackPanel>
                                            </Border>

                                            <Border Background='#FFF3E0' CornerRadius='8' Padding='10,6' Margin='0,0,8,8'>
                                                <StackPanel Orientation='Horizontal' VerticalAlignment='Center'>
                                                    <materialDesign:PackIcon Kind='CalendarClock' Width='18' Height='18' Foreground='#FF8A00'/>
                                                    <TextBlock Text='{Binding OrderDate, StringFormat="{}{0:dd/MM/yyyy HH:mm}"}' Margin='8,0,0,0' Foreground='#924A00'/>
                                                </StackPanel>
                                            </Border>

                                            <Border Background='#F3E8FF' CornerRadius='8' Padding='10,6' Margin='0,0,8,8'>
                                                <StackPanel Orientation='Horizontal' VerticalAlignment='Center'>
                                                    <materialDesign:PackIcon Kind='CreditCardOutline' Width='18' Height='18' Foreground='#8E24AA'/>
                                                    <TextBlock Text='{Binding PaymentStatus, Converter={StaticResource LangConverter}}' Margin='8,0,0,0' Foreground='#6A1B9A'/>
                                                </StackPanel>
                                            </Border>
                                        </WrapPanel>

                                        <WrapPanel Margin='0,4,0,0'>
                                            <Border Background='#FFF0F0' BorderBrush='#FFE0E0' BorderThickness='1' CornerRadius='8' Padding='10,6' Margin='0,0,8,0'>
                                                <StackPanel Orientation='Horizontal' VerticalAlignment='Center'>
                                                    <materialDesign:PackIcon Kind='ClockAlertOutline' Width='18' Height='18' Foreground='#FF6B6B'/>
                                                    <TextBlock Text='{Binding ApprovalStatus, Converter={StaticResource LangConverter}}' Margin='8,0,0,0' FontWeight='SemiBold' Foreground='#D84315'/>
                                                </StackPanel>
                                            </Border>
                                            <Border Background='#FFF7FF' BorderBrush='#F1D5FF' BorderThickness='1' CornerRadius='8' Padding='10,6'>
                                                <StackPanel Orientation='Horizontal' VerticalAlignment='Center'>
                                                    <materialDesign:PackIcon Kind='TruckFastOutline' Width='18' Height='18' Foreground='#512DA8'/>
                                                    <TextBlock Text='{Binding ShippingStatus, Converter={StaticResource LangConverter}}' Margin='8,0,0,0' Foreground='#512DA8'/>
                                                </StackPanel>
                                            </Border>
                                            <Border Background="#E8FFF1" BorderBrush="#C8E6C9" BorderThickness="1" CornerRadius="8" Padding="10,6" Margin="8,0,8,0">
                                                <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                                                    <materialDesign:PackIcon Kind="MapMarkerOutline" Width="18" Height="18" Foreground="#1B5E20"/>
                                                    <TextBlock Text="{Binding Address}" Margin="8,0,0,0" Foreground="#1B5E20" TextTrimming="CharacterEllipsis" MaxWidth="420"/>
                                                </StackPanel>
                                            </Border>
                                        </WrapPanel>
                                    </StackPanel>

                                    <StackPanel Grid.Column='1' HorizontalAlignment='Right' VerticalAlignment='Top'>
                                        <TextBlock Text='Tổng tiền' Foreground='#6A6A6A' FontWeight='SemiBold' HorizontalAlignment='Right'/>
                                        <TextBlock Text='{Binding TotalAmount, StringFormat="{}{0:N0} ₫"}' Foreground='#E53935' FontSize='22' FontWeight='ExtraBold' HorizontalAlignment='Right'/>
                                    </StackPanel>
                                </Grid>

                                <Border Grid.Row='1' Background='#FFF8F5' BorderBrush='#FFE1D5' BorderThickness='1' CornerRadius='8' Padding='10' Margin='0,0,0,10'>
                                    <StackPanel Orientation='Horizontal'>
                                        <materialDesign:PackIcon Kind='CommentTextMultipleOutline' Width='18' Height='18' Foreground='#D06B00' VerticalAlignment='Center'/>
                                        <TextBlock Text='Ghi chú:' Margin='8,0,6,0' FontWeight='SemiBold' Foreground='#D06B00' VerticalAlignment='Center'/>
                                        <TextBlock Text='{Binding Note}' TextWrapping='Wrap' Foreground='#444' VerticalAlignment='Center'/>
                                    </StackPanel>
                                </Border>

                                <!-- Danh sách sản phẩm -->
                                <ItemsControl Grid.Row='2' ItemsSource='{Binding Details}' Margin='0,0,0,10'>
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate>
                                            <Border BorderBrush='#FFE2B6' BorderThickness='1' CornerRadius='6' Padding='10' Margin='0,0,0,6' Background='#FFFDF8'>
                                                <Grid>
                                                    <Grid.ColumnDefinitions>
                                                        <ColumnDefinition Width="Auto"/>
                                                        <ColumnDefinition Width="*"/>
                                                        <ColumnDefinition Width="Auto"/>
                                                    </Grid.ColumnDefinitions>

                                                    <!-- Product Image -->
                                                    <Border Grid.Column="0" Width="60" Height="60" CornerRadius="10" BorderBrush="Transparent" BorderThickness="1" Margin="0,0,10,0" Background="White" Loaded="ImageBorder_Loaded">
                                                        <Image Source='{Binding Product.Picture}' Stretch='UniformToFill'/>
                                                    </Border>

                                                    <!-- Product Info -->
                                                    <StackPanel Grid.Column="1">
                                                        <TextBlock Text='{Binding Product.Name}' FontWeight='SemiBold'/>
                                                        <TextBlock Text='{Binding Product.Description}' FontStyle='Italic' Foreground='Gray' TextWrapping='Wrap' MaxWidth='600'/>
                                                        <TextBlock Margin='0,4,0,0'>
                                                            <Run Text='Số lượng: '/>
                                                            <Run Text='{Binding Quantity}'/>
                                                            <Run Text=' | Giá: '/>
                                                            <Run Text='{Binding Product.UnitPrice, StringFormat="{}{0:N0} ₫"}'/>
                                                            <Run Text=' | Giảm: '/>
                                                            <Run Text='{Binding Product.Discount, StringFormat={}{0:P0}}'/>
                                                        </TextBlock>
                                                    </StackPanel>

                                                    <!-- Review Button -->
                                                    <Button Grid.Column="2"
                                                            Width="115"
                                                            Height="35"
                                                            VerticalAlignment="Center"
                                                            Margin="10,0,0,0"
                                                            BorderThickness="1.5"
                                                            BorderBrush="#F9D978"
                                                            Background="Transparent"
                                                            Cursor="Hand"
                                                            Click="ReviewButton_Click"
                                                            Tag="{Binding}">
                                                        <Button.Template>
                                                            <ControlTemplate TargetType="Button">
                                                                <Border x:Name="border"
                                                                        Background="{TemplateBinding Background}"
                                                                        BorderBrush="{TemplateBinding BorderBrush}"
                                                                        BorderThickness="{TemplateBinding BorderThickness}"
                                                                        CornerRadius="8">
                                                                    <StackPanel Orientation="Horizontal"
                                                                                HorizontalAlignment="Center"
                                                                                VerticalAlignment="Center">
                                                                        <materialDesign:PackIcon x:Name="icon"
                                                                                                 Kind="RateReview"
                                                                                                 Width="18"
                                                                                                 Height="18"
                                                                                                 Foreground="#F9D978"
                                                                                                 VerticalAlignment="Center"
                                                                                                 Margin="0,0,6,0"/>
                                                                        <TextBlock x:Name="text"
                                                                                   Text="Đánh giá"
                                                                                   FontSize="15"
                                                                                   FontWeight="SemiBold"
                                                                                   Foreground="#F9D978"
                                                                                   VerticalAlignment="Center"/>
                                                                    </StackPanel>
                                                                </Border>
                                                                <ControlTemplate.Triggers>
                                                                    <Trigger Property="IsMouseOver" Value="True">
                                                                        <Setter TargetName="border" Property="Background" Value="#F9D978"/>
                                                                        <Setter TargetName="icon" Property="Foreground" Value="White"/>
                                                                        <Setter TargetName="text" Property="Foreground" Value="White"/>
                                                                    </Trigger>
                                                                    <Trigger Property="IsPressed" Value="True">
                                                                        <Setter TargetName="border" Property="Background" Value="#F0C860"/>
                                                                    </Trigger>
                                                                </ControlTemplate.Triggers>
                                                            </ControlTemplate>
                                                        </Button.Template>
                                                    </Button>
                                                </Grid>
                                            </Border>
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>

                                <StackPanel Grid.Row='3' Orientation='Horizontal' HorizontalAlignment='Right'>
                                    <Button Style="{StaticResource MaterialDesignOutlinedButton}" Padding="12 8" Tag="{Binding}" Click="reorderbtn_Click">
                                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" VerticalAlignment="Center">
                                            <materialDesign:PackIcon Kind="Replay" Width="20" Height="20" Margin="0,0,6,0" VerticalAlignment="Center"/>
                                            <TextBlock Text="Đặt lại" FontWeight="SemiBold" VerticalAlignment="Center"/>
                                        </StackPanel>
                                    </Button>
                                </StackPanel>
                            </Grid>
                        </Border>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>
        </ScrollViewer>
    </Grid>
</Page>